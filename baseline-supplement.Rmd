---
title: "Baseline analysis supplement"
---

Welcome to the LMI baseline supplement! This supplement will walk you through the paper and provides additional graphs.

# Measures used in the study

Clicking the "Code"-buttons on the right shows code for each chunk.

To start data analysis, we set up the basics to enable compiling the document:

```{r verbose = FALSE, warning = FALSE, message = FALSE}
source("baseline-datasetup.R")
```


# Means with CIs taking clustering into account {.tabset}

## Description

The code chunks create linear models for all variables. The results are used to estimate confidence intervals and intra-class correlations (ICC).

Browse throught the tabs above to see different information.

Code chunk below shows how the values are calculated.

```{r}
# Create a vector with all names of the variables we want. Exclude T3 variables.
names <- df %>% select(-id, -intervention, -group, -school, -girl, -track, -trackSchool, -contains("_T3"), -contains("_diff")) %>% names(.)

# Create empty soon-to-be-filled objects
m <- NA
mean <- NA
m_p <- NA
ci_low <- NA
ci_high <- NA
ICC_group <- NA
ICC_School <- NA
nonmissings <- NA

## Use this to test a single variable:
# dftest <- df #%>% na.omit()
# m <- lme4::lmer(sitLieAccelerometer_diff ~ (1|school) + (1|group), data=dftest)
# mean <- lme4::fixef(m)
# m_p <- profile(m, which = "beta_")
# ci_low <- confint(m_p)[, 1]
# ci_high <- confint(m_p)[, 2]
# ICC_group <- icc(m)[1]
# ICC_School <- icc(m)[2]
# nonmissings <- length(m@resp$y)


# Loop over each variable name, extract statistics: 

# all participants
for (i in names){
m <- lme4::lmer(paste0(i," ~ (1|school) + (1|group)"), data=df)
mean[i] <- lme4::fixef(m)
m_p <- profile(m, which = "beta_")
ci_low[i] <- confint(m_p)[, 1]
ci_high[i] <- confint(m_p)[, 2]
ICC_group[i] <- sjstats::icc(m)[1]
ICC_School[i] <- sjstats::icc(m)[2]
nonmissings[i] <- length(m@resp$y)
}


vardatatable <- data_frame(
  Variable = stringr::str_sub(names(mean), end = -4), #remove "_T1" from names
  Mean = round(mean, 2), 
  CI95 = paste(round(ci_low, 2), "-", round(ci_high, 2)), 
  "ICC class" =ifelse(round(ICC_group, 3) == 0, "< 0.001", round(ICC_group, 3)), 
  "ICC school" = ifelse(round(ICC_School, 3) == 0, "< 0.001", round(ICC_School, 3)),
  n = nonmissings) %>% 
  dplyr::arrange(Variable) %>% 
  filter(Variable != "") %>% #remove first row, which is empty
  mutate(`ICC class` = as.numeric(`ICC class`)) %>% 
  as.data.frame()


```

## Primary outcome variables

```{r selected-total, results = 'asis'}
options(tibble.print_max = 1000)
 
vardatatable %>% 
  filter(Variable == "paAccelerometer" | Variable == "fatpct" | Variable == "sitLieAccelerometer" | Variable == "sitBreaks") %>% 
    papaja::apa_table(
        caption = "Primary outcome variables with their class and school ICCs",
        escape = T,
        format.args = list(digits = c(2, 3, 0), margin = 2))
```

## All main variables, their means, CIs and ICCs.


```{r allvars-total, results = 'asis'}
options(tibble.print_max = 1000)
 
vardatatable %>%
    papaja::apa_table(
        caption = "All variables with their class and school ICCs",
        escape = T,
        format.args = list(digits = c(2, 3, 0), margin = 2))
```

## ICC top 20 items, sorted by classroom ICC

```{r icc-school-class-sortbyclass, results = 'asis'}

vardatatable %>% 
  select(Variable, `ICC class`, `ICC school`, n) %>% 
  arrange(desc(`ICC class`)) %>% slice(1:20) %>% 
  as.tbl() %>% 
  papaja::apa_table(caption = "Intra-class correlations sorted by classroom ICC",
        format.args = list(digits = c(3, 0), margin = 2))

```

## ICC top 20 items, sorted by school ICC

```{r icc-school-class-sortbyschool, results = 'asis'}

vardatatable %>% select(Variable, `ICC class`, `ICC school`, n) %>% 
  arrange(desc(`ICC school`)) %>% 
  slice(1:20) %>% 
  papaja::apa_table(caption = "Intra-class correlations sorted by school ICC",
        format.args = list(digits = c(3, 0), margin = 2))

```

## Add educational track

The model below is the same as the one above, except it adds educational track. 

**IT MAY NOT MAKE SENSE TO HAVE BOTH TRACK AND SCHOOL HERE, AS THEY'RE ALMOST THE SAME?**

As before, we create a table with all variables, their means, CIs and ICCs.


```{r}
#library(sjstats)
#library(lme4)

names <- df %>% select(-id, -intervention, -group, -school, -girl, -track, -trackSchool, -contains("_T3"), -contains("_diff")) %>% names(.)

# Create empty soon-to-be-filled objects
m <- NA
mean <- NA
m_p <- NA
ci_low <- NA
ci_high <- NA
ICC_group <- NA
ICC_School <- NA
nonmissings <- NA
ICC_track <- NA


## To test the code with a single variable:
# dftest <- df #%>% na.omit()
# m <- lmer(sitLieAccelerometer_T1 ~ (1|school) + (1|group) + (1|track), data=df)
# mean <- fixef(m)
# m_p <- profile(m)
# ci_low <- confint(m_p)[5]
# ci_high <- confint(m_p)[10]
# ICC_group <- icc(m)[1]
# ICC_School <- icc(m)[2]
# nonmissings <- length(m@resp$y)

# Loop over each variable name, extract statistics: 

# all participants  
for (i in names){
m <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + (1|track)"), data=df)
mean[i] <- lme4::fixef(m)
m_p <- profile(m, which = "beta_")
ci_low[i] <- confint(m_p)[5]
ci_high[i] <- confint(m_p)[10]
ICC_group[i] <- sjstats::icc(m)[1]
ICC_School[i] <- sjstats::icc(m)[3]
ICC_track[i] <- sjstats::icc(m)[2]
nonmissings[i] <- length(m@resp$y)
}

vardatatable_containing_edutrack <- data_frame(
  Variable = stringr::str_sub(names(mean), end = -4), #remove "_T1" from names
  Mean = round(mean, 2), 
  CI95 = paste(round(ci_low, 2), "-", round(ci_high, 2)), 
  "ICC class" =ifelse(round(ICC_group, 3) == 0, "< 0.001", round(ICC_group, 3)), 
  "ICC school" = ifelse(round(ICC_School, 3) == 0, "< 0.001", round(ICC_School, 3)),
  "ICC educational track" = ifelse(round(ICC_track, 3) == 0, "< 0.001", round(ICC_track, 3)),
  n = nonmissings) %>% 
  dplyr::arrange(Variable) %>% 
  filter(Variable != "") #remove first row, which is empty

options(tibble.print_max = 15)

```

### Top 20 items, sorted by school

```{r icc-school-class-track-sortbyschool, results = 'asis'}

vardatatable_containing_edutrack %>% 
  select(Variable, `ICC educational track`, `ICC class`, `ICC school`, n) %>% 
  arrange(desc(`ICC school`)) %>% 
  top_n(20) %>% 
  papaja::apa_table(caption = "Intra-class correlations sorted by school ICC",
        format.args = list(digits = c(0), margin = 2))

```

### Top 20 items, sorted by classroom

```{r icc-school-class-track-sortbyclass, results = 'asis'}

vardatatable_containing_edutrack %>% select(Variable, `ICC educational track`, `ICC class`, `ICC school`, n) %>% arrange(desc(`ICC class`)) %>% top_n(20) %>% papaja::apa_table(caption = "Intra-class correlations sorted by classroom ICC",
        format.args = list(digits = c(0), margin = 2))

```

### Top 20 items, sorted by educational track

```{r icc-school-class-track-sortbytrack, results = 'asis'}

vardatatable_containing_edutrack %>% select(Variable, `ICC educational track`, `ICC class`, `ICC school`, n) %>% arrange(desc(`ICC educational track`)) %>% top_n(20) %>% papaja::apa_table(caption = "Intra-class correlations sorted by educational track ICC",
        format.args = list(digits = c(0), margin = 2))

```

### Model with educational track only

```{r}
#library(sjstats)
#library(lme4)

names <- df %>% select(-id, -intervention, -group, -school, -girl, -track, -trackSchool, -contains("_T3"), -contains("_diff")) %>% names(.)

# Create empty soon-to-be-filled objects
m <- NA
mean <- NA
m_p <- NA
ci_low <- NA
ci_high <- NA
ICC_group <- NA
ICC_School <- NA
nonmissings <- NA
ICC_track <- NA


## To test the code with a single variable:
# dftest <- df #%>% na.omit()
# m <- lmer(sitLieAccelerometer_T1 ~ (1|school) + (1|group) + (1|track), data=df)
# mean <- fixef(m)
# m_p <- profile(m)
# ci_low <- confint(m_p)[5]
# ci_high <- confint(m_p)[10]
# ICC_group <- icc(m)[1]
# ICC_School <- icc(m)[2]
# nonmissings <- length(m@resp$y)

# Loop over each variable name, extract statistics: 

# all participants  
for (i in names){
m <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + (1|track)"), data=df)
mean[i] <- lme4::fixef(m)
m_p <- profile(m, which = "beta_")
ci_low[i] <- confint(m_p)[5]
ci_high[i] <- confint(m_p)[10]
ICC_group[i] <- sjstats::icc(m)[1]
ICC_School[i] <- sjstats::icc(m)[3]
ICC_track[i] <- sjstats::icc(m)[2]
nonmissings[i] <- length(m@resp$y)
}

vardatatable_containing_edutrack <- data_frame(
  Variable = stringr::str_sub(names(mean), end = -4), #remove "_T1" from names
  Mean = round(mean, 2), 
  CI95 = paste(round(ci_low, 2), "-", round(ci_high, 2)), 
  "ICC class" =ifelse(round(ICC_group, 3) == 0, "< 0.001", round(ICC_group, 3)), 
  "ICC school" = ifelse(round(ICC_School, 3) == 0, "< 0.001", round(ICC_School, 3)),
  "ICC educational track" = ifelse(round(ICC_track, 3) == 0, "< 0.001", round(ICC_track, 3)),
  n = nonmissings) %>% 
  dplyr::arrange(Variable) %>% 
  filter(Variable != "") #remove first row, which is empty

options(tibble.print_max = 15)

```

Top 20 items, sorted by ICC educational track

```{r icc-edu-track-only, results = 'asis'}

vardatatable_containing_edutrack %>% 
  select(Variable, `ICC educational track`, n) %>% 
  arrange(desc(`ICC school`)) %>% 
  top_n(20) %>% 
  papaja::apa_table(caption = "Intra-class correlations sorted by educational track ICC",
        format.args = list(digits = c(0), margin = 2))

```

## Create confidence bounds for all items by gender and intervention allocation

These numbers are visualised with diamond plots later.

```{r}
names <- df %>% select(-id, -intervention, -group, -school, -girl, -track, -trackSchool, -contains("_T3"), -contains("_diff")) %>% names(.)

# Intercepts for boys; when boy is 1, girl is 0, but boy is a factor, so intercept is for boys even though boy is 1 for boys and 0 for girls.
m.boys <- NA
mean.boys <- NA
m_p.boys <- NA
ci_low.boys <- NA
ci_high.boys <- NA
ICC_group.boys <- NA
ICC_School.boys <- NA
nonmissings.boys <- NA

df.boys <- df %>% mutate(boy = factor(ifelse(girl == 1, 0, 1), levels = c(1, 0)))

for (i in names){
m.boys <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + boy"), data=df.boys)
mean.boys[i] <- lme4::fixef(m.boys)[1]
m_p.boys <- profile(m.boys, which = "beta_")
ci_low.boys[i] <- confint(m_p.boys)[1, 1]
ci_high.boys[i] <- confint(m_p.boys)[1, 2]
ICC_group.boys[i] <- sjstats::icc(m.boys)[1]
ICC_School.boys[i] <- sjstats::icc(m.boys)[2]
nonmissings.boys[i] <- length(m.boys@resp$y)
}

cat("The labels are arranged such that intercept is not for girls:", labels(lme4::fixef(m.boys))[2] == "boy0")

ci_boys <- data.frame(ciLo = ci_low.boys, mean = mean.boys, ciHi = ci_high.boys)
diamondlabels <- labels(ci_boys)[[1]]
ci_boys <- data.frame(ci_boys, diamondlabels)

# Intercepts for girls; when boy is 1, girl is 0, but boy is a factor, so intercept is for girls even though girl is 1 for girls and 0 for boys.
m.girls <- NA
mean.girls <- NA
m_p.girls <- NA
ci_low.girls <- NA
ci_high.girls <- NA
ICC_group.girls <- NA
ICC_School.girls <- NA
nonmissings.girls <- NA

for (i in names){
m.girls <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + girl"), data=df)
mean.girls[i] <- lme4::fixef(m.girls)[1]
m_p.girls <- profile(m.girls, which = "beta_")
ci_low.girls[i] <- confint(m_p.girls)[1, 1]
ci_high.girls[i] <- confint(m_p.girls)[1, 2]
ICC_group.girls[i] <- sjstats::icc(m.girls)[1]
ICC_School.girls[i] <- sjstats::icc(m.girls)[2]
nonmissings.girls[i] <- length(m.girls@resp$y)
}

cat("The labels are arranged such that intercept is not for boys:", labels(lme4::fixef(m.girls))[2] == "girl0")

ci_girls <- data.frame(ciLo = ci_low.girls, mean = mean.girls, ciHi = ci_high.girls)
diamondlabels <- labels(ci_girls)[[1]]
ci_girls <- data.frame(ci_girls, diamondlabels)


# Intercepts for intervention
m.intervention <- NA
mean.intervention <- NA
m_p.intervention <- NA
ci_low.intervention <- NA
ci_high.intervention <- NA
ICC_group.intervention <- NA
ICC_School.intervention <- NA
nonmissings.intervention <- NA

## change "intervention" to be consistent regarding level order with "girl".
df.intervention <- df %>% mutate(intervention = factor(intervention, levels = c(1, 0)))

for (i in names){
m.intervention <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + intervention"), data=df.intervention)
mean.intervention[i] <- lme4::fixef(m.intervention)[1]
m_p.intervention <- profile(m.intervention, which = "beta_")
ci_low.intervention[i] <- confint(m_p.intervention)[1, 1]
ci_high.intervention[i] <- confint(m_p.intervention)[1, 2]
ICC_group.intervention[i] <- sjstats::icc(m.intervention)[1]
ICC_School.intervention[i] <- sjstats::icc(m.intervention)[2]
nonmissings.intervention[i] <- length(m.intervention@resp$y)
}

cat("The labels are arranged such that intercept is not for control:", labels(lme4::fixef(m.intervention))[2] == "intervention0")

ci_intervention <- data.frame(ciLo = ci_low.intervention, mean = mean.intervention, ciHi = ci_high.intervention)
diamondlabels <- labels(ci_intervention)[[1]]
ci_intervention <- data.frame(ci_intervention, diamondlabels)

# Intercepts for control

m.control <- NA
mean.control <- NA
m_p.control <- NA
ci_low.control <- NA
ci_high.control <- NA
ICC_group.control <- NA
ICC_School.control <- NA
nonmissings.control <- NA

df.control <- df %>% mutate(control = factor(ifelse(intervention == 1, 0, 1), levels = c(1, 0)))

for (i in names){
m.control <- lme4::lmer(paste0(i," ~ (1|school) + (1|group) + control"), data=df.control)
mean.control[i] <- lme4::fixef(m.control)[1]
m_p.control <- profile(m.control, which = "beta_")
ci_low.control[i] <- confint(m_p.control)[1, 1]
ci_high.control[i] <- confint(m_p.control)[1, 2]
ICC_group.control[i] <- sjstats::icc(m.control)[1]
ICC_School.control[i] <- sjstats::icc(m.control)[2]
nonmissings.control[i] <- length(m.control@resp$y)
}

cat("The labels are arranged such that intercept is not for intervention:", labels(lme4::fixef(m.control))[2] == "control0")

ci_control <- data.frame(ciLo = ci_low.control, mean = mean.control, ciHi = ci_high.control)
diamondlabels <- labels(ci_control)[[1]]
ci_control <- data.frame(ci_control, diamondlabels)

# Same ICC results you'd get with e.g.:
# m1 <- as.data.frame(VarCorr(m))
# m1$vcov[1] / (m1$vcov[1] + m1$vcov[3])

# Or from broom:
# tidy(m)$estimate[2]^2 / (tidy(m)$estimate[2]^2 + tidy(m)$estimate[4]^2)

# Or from sjstats:
# sum(get_re_var(m)) / (sum(get_re_var(m)) + get_re_var(m, "sigma_2"))


```

# Descriptive tables

## prepare data

```{r demographics-prep}

demographics <- lmi %>% dplyr::select(id = ID,
birthYear = Kys0004.1,
intervention = ryhma,
school = Aineisto.1,
girl = Kys0013.1,
ethnicity = Kys0005.1,
studyYear = Kys0014.1) %>% 
  mutate(age = 2016 - birthYear,
         intervention = ifelse(intervention == 1, 1, 0),
         intervention = as.numeric(intervention),
         girl = ifelse(girl == 2, 1, 0),
          girl = as.numeric(girl, levels = c("1", "0")),
         school = factor(school, levels = c("1", "2", "3", "4", "5")),
         bornInFinland = as.numeric(ifelse(ethnicity == 1, 1, 0)),
         studyYear = ifelse(studyYear == 0, NA, studyYear)) # Remove "other" from study year

# Insert track variable with those who answered "other" with one of the actual category labels given the appropriate category:
Track <- lmi %>% select(Kys0016.1, Kys0017.1) %>% mutate(
  Kys0016.1 = ifelse(Kys0017.1 == "Merkonomi" | Kys0017.1 == "merkonomi", 3,
                  ifelse(Kys0017.1 == "Datanomi" | Kys0017.1 == "datanomi", 2, Kys0016.1)),
  Track = factor(Kys0016.1, # Fix track labels first
                     levels = c(0, 1, 2, 3, 4),
                     labels = c("Other", "Business IT", "Business Admin", "HRC", "Nursing"))) %>% 
  select(-Kys0016.1, -Kys0017.1)

demographics <- bind_cols(demographics, Track)
```

## Create demographic tables

### By educational track

```{r demographics-table-track, results = 'asis'}
demotable <- demographics %>% 
  group_by(Track) %>% 
  summarise("Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% girl" = round(mean(girl, na.rm = T)*100, 1),
            "% intervention" = round(mean(intervention, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n()) %>% 
  filter(complete.cases(.)) %>% 
  arrange(desc(Track)) 

demotable_total <- demographics %>% 
  summarise("Track" = "Full sample",
            "Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% girl" = round(mean(girl, na.rm = T)*100, 1),
            "% intervention" = round(mean(intervention, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n())

demotable <- bind_rows(demotable, demotable_total)

demotable <- demotable %>% tidyr::gather(Variable, val, 2:ncol(demotable)) %>% tidyr::spread(Track, val)

# For some reason, sum of n's of all tracks is 1084.

papaja::apa_table(demotable, caption = "Baseline demographics of educational tracks", digits = c(0, 1, 1, 1, 1, 1, 0))
```

### By gender

```{r demographics-table-gender, results = 'asis'}
demographics$Girl <- factor(demographics$girl)

demotable <- demographics %>% 
  group_by(Girl) %>% 
  summarise("Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% intervention" = round(mean(intervention, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n()) %>% 
  filter(complete.cases(.)) %>% 
  arrange(desc(Girl)) 

demotable_total <- demographics %>% 
  summarise("Girl" = "Full sample",
            "Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% intervention" = round(mean(intervention, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n())

demotable <- bind_rows(demotable, demotable_total)

demotable <- demotable %>% tidyr::gather(Variable, val, 2:ncol(demotable)) %>% tidyr::spread(Girl, val)

names(demotable) <- c("", "Boy", "Girl", "Full sample")

# For some reason, sum of n's of all tracks is 1084.

papaja::apa_table(demotable, caption = "Baseline demographics of educational tracks", digits = c(0, 1, 1, 1, 1, 0))
```

### By intervention participation

```{r demographics-table-intervention, results = 'asis'}
demographics$intervention <- factor(demographics$intervention)
demographics$girl <- as.numeric(demographics$girl)

demotable <- demographics %>% 
  group_by(intervention) %>% 
  summarise("Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% girl" = round(mean(girl, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n()) %>% 
  filter(complete.cases(.)) %>% 
  arrange(desc(intervention)) 

demotable_total <- demographics %>% 
  summarise("intervention" = "Full sample",
            "Mean age (range)" = paste0(round(mean(age, na.rm = T), 1)," (", 
                                        range(age, na.rm = T)[1], "-",
                                        range(age, na.rm = T)[2], ")"),
            "Mean study year (sd)" = paste0(round(mean(studyYear, na.rm = T), 1)," (", 
                                               round(sd(studyYear, na.rm = T), 1), ")"),
            "% girl" = round(mean(girl, na.rm = T)*100, 1),
            "% born in Finland" = round(mean(bornInFinland, na.rm = T)*100, 1),
            n = n())

demotable <- bind_rows(demotable, demotable_total)

demotable <- demotable %>% tidyr::gather(Variable, val, 2:ncol(demotable)) %>% tidyr::spread(intervention, val)

names(demotable) <- c("", "Control", "Intervention", "Full sample")

# For some reason, sum of n's of all tracks is 1084.

papaja::apa_table(demotable, caption = "Baseline demographics of educational tracks", digits = c(0, 1, 1, 1, 1, 0))
```

## Create outcome tables

```{r outcome-table, results = 'asis'}

outtable_track <- df %>%
  select(paAccelerometer_T1, sitLieAccelerometer_T1, sitBreaks_T1, # Main outcomes 
          PA_actionplan_T1,
          PA_copingplan_T1,
          PA_agrbct_T1,
          PA_frqbct_T1,
          PA_amotivation_T1,
          PA_autonomous_T1,
          PA_controlled_T1,
          PA_goal_T1,
          PA_inorm_T1,
          PA_dnorm_T1,
          PA_intention_T1,
          PA_outcomeExpectations_T1,
          PA_opportunities_T1,
          PA_pbc_T1,
          PA_selfefficacy_T1,
          SB_dnorm_T1,
          SB_inorm_T1,
          SB_intention_T1,
          SB_outcomeExpectations_T1,
          SB_sePbc_T1,
         track, girl, intervention) %>% 
  group_by(track) %>% 
  summarise(
            'PA action planning' = paste0(round(mean(PA_actionplan_T1, na.rm = TRUE), 1), " (", round(sd(PA_actionplan_T1, na.rm = T), 1), ")"),
            'PA coping planning' = paste0(round(mean(PA_copingplan_T1, na.rm = TRUE), 1), ' (', round(sd(PA_copingplan_T1, na.rm = T), 1), ')'),
            'PA agreement-BCTs' = paste0(round(mean(PA_agrbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_agrbct_T1, na.rm = T), 1), ')'),
            'PA frequency-BCTs' = paste0(round(mean(PA_frqbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_frqbct_T1, na.rm = T), 1), ')'),
            'PA amotivation' = paste0(round(mean(PA_amotivation_T1, na.rm = TRUE), 1), ' (', round(sd(PA_amotivation_T1, na.rm = T), 1), ')'),
            'PA autonomous regulation' = paste0(round(mean(PA_autonomous_T1, na.rm = TRUE), 1), ' (', round(sd(PA_autonomous_T1, na.rm = T), 1), ')'),
            'PA controlled regulation' = paste0(round(mean(PA_controlled_T1, na.rm = TRUE), 1), ' (', round(sd(PA_controlled_T1, na.rm = T), 1), ')'),
            'PA injunctive norm' = paste0(round(mean(PA_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_inorm_T1, na.rm = T), 1), ')'),
            'PA descriptive norm' = paste0(round(mean(PA_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_dnorm_T1, na.rm = T), 1), ')'),
            'PA intention' = paste0(round(mean(PA_intention_T1, na.rm = TRUE), 1), ' (', round(sd(PA_intention_T1, na.rm = T), 1), ')'),
            'PA outcome expectations' = paste0(round(mean(PA_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(PA_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'PA opportunities' = paste0(round(mean(PA_opportunities_T1, na.rm = TRUE), 1), ' (', round(sd(PA_opportunities_T1, na.rm = T), 1), ')'),
            'PA perceived behavioural control' = paste0(round(mean(PA_pbc_T1, na.rm = TRUE), 1), ' (', round(sd(PA_pbc_T1, na.rm = T), 1), ')'),
            'PA self-efficacy' = paste0(round(mean(PA_selfefficacy_T1, na.rm = TRUE), 1), ' (', round(sd(PA_selfefficacy_T1, na.rm = T), 1), ')'),
            'SB descriptive norm' = paste0(round(mean(SB_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_dnorm_T1, na.rm = T), 1), ')'),
            'SB injunctive norm' = paste0(round(mean(SB_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_inorm_T1, na.rm = T), 1), ')'),
            'SB intention' = paste0(round(mean(SB_intention_T1, na.rm = TRUE), 1), ' (', round(sd(SB_intention_T1, na.rm = T), 1), ')'),
            'SB outcome expectations' = paste0(round(mean(SB_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(SB_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'SB self-efficacy & perceived behavioural control' = paste0(round(mean(SB_sePbc_T1, na.rm = TRUE), 1), ' (', round(sd(SB_sePbc_T1, na.rm = T), 1), ')'),

            "Mean daily MVPA minutes" = paste0(round(mean(paAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(paAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily minutes spent sitting or lying down" = paste0(round(mean(sitLieAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(sitLieAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily breaks in sitting" = paste0(round(mean(sitBreaks_T1, na.rm = T), 1)," (", 
                                        round(sd(sitBreaks_T1, na.rm = T), 1), ")"),
            n = n()) %>% 
  filter(complete.cases(.)) %>% 
  arrange(desc(track)) %>% 
  filter(track != "Other")

outtable_intervention <- df %>%
  select(paAccelerometer_T1, sitLieAccelerometer_T1, sitBreaks_T1, # Main outcomes 
          PA_actionplan_T1,
          PA_copingplan_T1,
          PA_agrbct_T1,
          PA_frqbct_T1,
          PA_amotivation_T1,
          PA_autonomous_T1,
          PA_controlled_T1,
          PA_goal_T1,
          PA_inorm_T1,
          PA_dnorm_T1,
          PA_intention_T1,
          PA_outcomeExpectations_T1,
          PA_opportunities_T1,
          PA_pbc_T1,
          PA_selfefficacy_T1,
          SB_dnorm_T1,
          SB_inorm_T1,
          SB_intention_T1,
          SB_outcomeExpectations_T1,
          SB_sePbc_T1,
         track, girl, intervention) %>% 
  group_by(intervention) %>% 
  summarise(
            'PA action planning' = paste0(round(mean(PA_actionplan_T1, na.rm = TRUE), 1), " (", round(sd(PA_actionplan_T1, na.rm = T), 1), ")"),
            'PA coping planning' = paste0(round(mean(PA_copingplan_T1, na.rm = TRUE), 1), ' (', round(sd(PA_copingplan_T1, na.rm = T), 1), ')'),
            'PA agreement-BCTs' = paste0(round(mean(PA_agrbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_agrbct_T1, na.rm = T), 1), ')'),
            'PA frequency-BCTs' = paste0(round(mean(PA_frqbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_frqbct_T1, na.rm = T), 1), ')'),
            'PA amotivation' = paste0(round(mean(PA_amotivation_T1, na.rm = TRUE), 1), ' (', round(sd(PA_amotivation_T1, na.rm = T), 1), ')'),
            'PA autonomous regulation' = paste0(round(mean(PA_autonomous_T1, na.rm = TRUE), 1), ' (', round(sd(PA_autonomous_T1, na.rm = T), 1), ')'),
            'PA controlled regulation' = paste0(round(mean(PA_controlled_T1, na.rm = TRUE), 1), ' (', round(sd(PA_controlled_T1, na.rm = T), 1), ')'),
            'PA injunctive norm' = paste0(round(mean(PA_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_inorm_T1, na.rm = T), 1), ')'),
            'PA descriptive norm' = paste0(round(mean(PA_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_dnorm_T1, na.rm = T), 1), ')'),
            'PA intention' = paste0(round(mean(PA_intention_T1, na.rm = TRUE), 1), ' (', round(sd(PA_intention_T1, na.rm = T), 1), ')'),
            'PA outcome expectations' = paste0(round(mean(PA_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(PA_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'PA opportunities' = paste0(round(mean(PA_opportunities_T1, na.rm = TRUE), 1), ' (', round(sd(PA_opportunities_T1, na.rm = T), 1), ')'),
            'PA perceived behavioural control' = paste0(round(mean(PA_pbc_T1, na.rm = TRUE), 1), ' (', round(sd(PA_pbc_T1, na.rm = T), 1), ')'),
            'PA self-efficacy' = paste0(round(mean(PA_selfefficacy_T1, na.rm = TRUE), 1), ' (', round(sd(PA_selfefficacy_T1, na.rm = T), 1), ')'),
            'SB descriptive norm' = paste0(round(mean(SB_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_dnorm_T1, na.rm = T), 1), ')'),
            'SB injunctive norm' = paste0(round(mean(SB_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_inorm_T1, na.rm = T), 1), ')'),
            'SB intention' = paste0(round(mean(SB_intention_T1, na.rm = TRUE), 1), ' (', round(sd(SB_intention_T1, na.rm = T), 1), ')'),
            'SB outcome expectations' = paste0(round(mean(SB_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(SB_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'SB self-efficacy & perceived behavioural control' = paste0(round(mean(SB_sePbc_T1, na.rm = TRUE), 1), ' (', round(sd(SB_sePbc_T1, na.rm = T), 1), ')'),

            "Mean daily MVPA minutes" = paste0(round(mean(paAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(paAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily minutes spent sitting or lying down" = paste0(round(mean(sitLieAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(sitLieAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily breaks in sitting" = paste0(round(mean(sitBreaks_T1, na.rm = T), 1)," (", 
                                        round(sd(sitBreaks_T1, na.rm = T), 1), ")"),
            n = n()) %>% 
  filter(complete.cases(.))

outtable_girl <- df %>%
  select(paAccelerometer_T1, sitLieAccelerometer_T1, sitBreaks_T1, # Main outcomes 
          PA_actionplan_T1,
          PA_copingplan_T1,
          PA_agrbct_T1,
          PA_frqbct_T1,
          PA_amotivation_T1,
          PA_autonomous_T1,
          PA_controlled_T1,
          PA_goal_T1,
          PA_inorm_T1,
          PA_dnorm_T1,
          PA_intention_T1,
          PA_outcomeExpectations_T1,
          PA_opportunities_T1,
          PA_pbc_T1,
          PA_selfefficacy_T1,
          SB_dnorm_T1,
          SB_inorm_T1,
          SB_intention_T1,
          SB_outcomeExpectations_T1,
          SB_sePbc_T1,
         track, girl, intervention) %>% 
  group_by(girl) %>% 
  summarise(
            'PA action planning' = paste0(round(mean(PA_actionplan_T1, na.rm = TRUE), 1), " (", round(sd(PA_actionplan_T1, na.rm = T), 1), ")"),
            'PA coping planning' = paste0(round(mean(PA_copingplan_T1, na.rm = TRUE), 1), ' (', round(sd(PA_copingplan_T1, na.rm = T), 1), ')'),
            'PA agreement-BCTs' = paste0(round(mean(PA_agrbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_agrbct_T1, na.rm = T), 1), ')'),
            'PA frequency-BCTs' = paste0(round(mean(PA_frqbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_frqbct_T1, na.rm = T), 1), ')'),
            'PA amotivation' = paste0(round(mean(PA_amotivation_T1, na.rm = TRUE), 1), ' (', round(sd(PA_amotivation_T1, na.rm = T), 1), ')'),
            'PA autonomous regulation' = paste0(round(mean(PA_autonomous_T1, na.rm = TRUE), 1), ' (', round(sd(PA_autonomous_T1, na.rm = T), 1), ')'),
            'PA controlled regulation' = paste0(round(mean(PA_controlled_T1, na.rm = TRUE), 1), ' (', round(sd(PA_controlled_T1, na.rm = T), 1), ')'),
            'PA injunctive norm' = paste0(round(mean(PA_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_inorm_T1, na.rm = T), 1), ')'),
            'PA descriptive norm' = paste0(round(mean(PA_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_dnorm_T1, na.rm = T), 1), ')'),
            'PA intention' = paste0(round(mean(PA_intention_T1, na.rm = TRUE), 1), ' (', round(sd(PA_intention_T1, na.rm = T), 1), ')'),
            'PA outcome expectations' = paste0(round(mean(PA_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(PA_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'PA opportunities' = paste0(round(mean(PA_opportunities_T1, na.rm = TRUE), 1), ' (', round(sd(PA_opportunities_T1, na.rm = T), 1), ')'),
            'PA perceived behavioural control' = paste0(round(mean(PA_pbc_T1, na.rm = TRUE), 1), ' (', round(sd(PA_pbc_T1, na.rm = T), 1), ')'),
            'PA self-efficacy' = paste0(round(mean(PA_selfefficacy_T1, na.rm = TRUE), 1), ' (', round(sd(PA_selfefficacy_T1, na.rm = T), 1), ')'),
            'SB descriptive norm' = paste0(round(mean(SB_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_dnorm_T1, na.rm = T), 1), ')'),
            'SB injunctive norm' = paste0(round(mean(SB_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_inorm_T1, na.rm = T), 1), ')'),
            'SB intention' = paste0(round(mean(SB_intention_T1, na.rm = TRUE), 1), ' (', round(sd(SB_intention_T1, na.rm = T), 1), ')'),
            'SB outcome expectations' = paste0(round(mean(SB_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(SB_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'SB self-efficacy & perceived behavioural control' = paste0(round(mean(SB_sePbc_T1, na.rm = TRUE), 1), ' (', round(sd(SB_sePbc_T1, na.rm = T), 1), ')'),

            "Mean daily MVPA minutes" = paste0(round(mean(paAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(paAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily minutes spent sitting or lying down" = paste0(round(mean(sitLieAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(sitLieAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily breaks in sitting" = paste0(round(mean(sitBreaks_T1, na.rm = T), 1)," (", 
                                        round(sd(sitBreaks_T1, na.rm = T), 1), ")"),
            n = n()) %>% 
  filter(complete.cases(.))

outtable_total <- df %>% 
  summarise('girl' = "Full sample",
            'PA action planning' = paste0(round(mean(PA_actionplan_T1, na.rm = TRUE), 1), " (", round(sd(PA_actionplan_T1, na.rm = T), 1), ")"),
            'PA coping planning' = paste0(round(mean(PA_copingplan_T1, na.rm = TRUE), 1), ' (', round(sd(PA_copingplan_T1, na.rm = T), 1), ')'),
            'PA agreement-BCTs' = paste0(round(mean(PA_agrbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_agrbct_T1, na.rm = T), 1), ')'),
            'PA frequency-BCTs' = paste0(round(mean(PA_frqbct_T1, na.rm = TRUE), 1), ' (', round(sd(PA_frqbct_T1, na.rm = T), 1), ')'),
            'PA amotivation' = paste0(round(mean(PA_amotivation_T1, na.rm = TRUE), 1), ' (', round(sd(PA_amotivation_T1, na.rm = T), 1), ')'),
            'PA autonomous regulation' = paste0(round(mean(PA_autonomous_T1, na.rm = TRUE), 1), ' (', round(sd(PA_autonomous_T1, na.rm = T), 1), ')'),
            'PA controlled regulation' = paste0(round(mean(PA_controlled_T1, na.rm = TRUE), 1), ' (', round(sd(PA_controlled_T1, na.rm = T), 1), ')'),
            'PA injunctive norm' = paste0(round(mean(PA_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_inorm_T1, na.rm = T), 1), ')'),
            'PA descriptive norm' = paste0(round(mean(PA_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(PA_dnorm_T1, na.rm = T), 1), ')'),
            'PA intention' = paste0(round(mean(PA_intention_T1, na.rm = TRUE), 1), ' (', round(sd(PA_intention_T1, na.rm = T), 1), ')'),
            'PA outcome expectations' = paste0(round(mean(PA_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(PA_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'PA opportunities' = paste0(round(mean(PA_opportunities_T1, na.rm = TRUE), 1), ' (', round(sd(PA_opportunities_T1, na.rm = T), 1), ')'),
            'PA perceived behavioural control' = paste0(round(mean(PA_pbc_T1, na.rm = TRUE), 1), ' (', round(sd(PA_pbc_T1, na.rm = T), 1), ')'),
            'PA self-efficacy' = paste0(round(mean(PA_selfefficacy_T1, na.rm = TRUE), 1), ' (', round(sd(PA_selfefficacy_T1, na.rm = T), 1), ')'),
            'SB descriptive norm' = paste0(round(mean(SB_dnorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_dnorm_T1, na.rm = T), 1), ')'),
            'SB injunctive norm' = paste0(round(mean(SB_inorm_T1, na.rm = TRUE), 1), ' (', round(sd(SB_inorm_T1, na.rm = T), 1), ')'),
            'SB intention' = paste0(round(mean(SB_intention_T1, na.rm = TRUE), 1), ' (', round(sd(SB_intention_T1, na.rm = T), 1), ')'),
            'SB outcome expectations' = paste0(round(mean(SB_outcomeExpectations_T1, na.rm = TRUE), 1), ' (', round(sd(SB_outcomeExpectations_T1, na.rm = T), 1), ')'),
            'SB self-efficacy & perceived behavioural control' = paste0(round(mean(SB_sePbc_T1, na.rm = TRUE), 1), ' (', round(sd(SB_sePbc_T1, na.rm = T), 1), ')'),

            "Mean daily MVPA minutes" = paste0(round(mean(paAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(paAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily minutes spent sitting or lying down" = paste0(round(mean(sitLieAccelerometer_T1, na.rm = T), 1)," (", 
                                        round(sd(sitLieAccelerometer_T1, na.rm = T), 1), ")"),
            "Mean daily breaks in sitting" = paste0(round(mean(sitBreaks_T1, na.rm = T), 1)," (", 
                                        round(sd(sitBreaks_T1, na.rm = T), 1), ")"),
            n = n())



# Transpose each table
outtable_track <- outtable_track %>% tidyr::gather(Variable, val, 2:ncol(.)) %>% tidyr::spread(track, val)

outtable_intervention <- outtable_intervention %>% tidyr::gather(Variable, val, 2:ncol(.)) %>% tidyr::spread(intervention, val)
names(outtable_intervention) <- c("Variable", "Control", "Intervention")

## In the last table, have a column for total before transposing
outtable_girl <- bind_rows(outtable_girl, outtable_total)
outtable_girl <- outtable_girl %>% tidyr::gather(Variable, val, 2:ncol(.)) %>% tidyr::spread(girl, val)
names(outtable_girl) <- c("Variable", "Boy", "Girl", "Full sample")

# Are all variables the same?
identical(outtable_track$Variable, outtable_girl$Variable)
identical(outtable_track$Variable, outtable_intervention$Variable)

# Create large table with all variables
outtable_mega <- bind_cols(outtable_track, outtable_intervention, outtable_girl) %>% 
  select(-Variable1, -Variable2) 

# Move n to be the first row
out1 <- outtable_mega %>% filter(Variable == "n")
out2 <- outtable_mega %>% filter(Variable != "n")
outtable_mega <- bind_rows(out1, out2)

# Fix names: leave first blank, have the rest as they were
names(outtable_mega) <- c("", names(outtable_mega)[2:(length(names(outtable_mega)))])

papaja::apa_table(outtable_mega, caption = "Baseline demographics of educational tracks")


```


# PA psychosocial determinants: self report scales T1

```{r}
PA_ci_girls <- ci_girls %>% filter(diamondlabels %in% names(scales_T1) & grepl("PA_", diamondlabels) & !grepl("bct", diamondlabels))

PA_ci_boys <- ci_boys %>% filter(diamondlabels %in% names(scales_T1) & grepl("PA_", diamondlabels) & !grepl("bct", diamondlabels))

PA_ci_intervention <- ci_intervention %>% filter(diamondlabels %in% names(scales_T1) & grepl("PA_", diamondlabels) & !grepl("bct", diamondlabels))

PA_ci_control <- ci_control %>% filter(diamondlabels %in% names(scales_T1) & grepl("PA_", diamondlabels) & !grepl("bct", diamondlabels))

ICClabels <- vardatatable_containing_edutrack %>% filter(Variable %in% PA_ci_control$diamondlabels)

library(ggplot2)
plot1 <- userfriendlyscience::diamondPlot(PA_ci_girls, color = 'green', alpha=.3, yLabels = PA_ci_girls$diamondlabels, fixedSize = 0.3, xlab = NULL) +
  userfriendlyscience::diamondPlot(PA_ci_boys, returnLayerOnly = TRUE, color='blue', alpha=.3, fixedSize = 0.3) +
  scale_x_continuous(limits = c(1, 7), breaks = 1:7)

plot2 <- userfriendlyscience::diamondPlot(PA_ci_intervention, color = 'red', alpha=.3, yLabels = c(rep("", length(PA_ci_girls$diamondlabels))), fixedSize = 0.3, xlab = NULL, ylab = NULL) +
  userfriendlyscience::diamondPlot(PA_ci_control, returnLayerOnly = TRUE, color='black', alpha=.3, fixedSize = 0.3) +
  scale_x_continuous(limits = c(1, 7), breaks = 1:7)

grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))

# dat2 <- data.frame(ciLo = c(3, 2), mean = c(4, 2.5), ciHi = c(6, 3));
# userfriendlyscience::diamondPlot(dat1, color = 'blue', alpha=.3, yLabels = dat1$diamondlabels) +
# userfriendlyscience::diamondPlot(dat2, returnLayerOnly = TRUE, color='red', alpha=.3)
 
```

Note: action and coping planning on a scale from 1 to 4.

# Visualising random effects using full posterior (UNDER CONSTRUCTION)

## Using rstanarm

Plot below shows credible intervals deviations  

```{r randeff-plot-rstanarm}
library(rstanarm)
# grep("PA_", names(df), value = TRUE)

# Centre the variable:
df <- df %>% mutate(paAccelerometer_T1_centred = paAccelerometer_T1 - mean(paAccelerometer_T1, na.rm = TRUE))

m_1 <- stan_glmer(paAccelerometer_T1_centred ~ (1 | group), data = df, chains = 2, iter = 2000) 
pt <- ranef(m_1) 
posteriors <- data.frame(posterior_interval(m_1, prob = 0.90)) 
school_int <- posteriors[-c(1, nrow(posteriors)-1, nrow(posteriors)),] #remove intercept and sigma parameters, leaving only class intervals 

# This not needed any more:
# groupmeans <- df %>% select(paAccelerometer_T1, group) %>% group_by(group) %>% 
#   summarise(mean = mean(paAccelerometer_T1, na.rm = T)) %>% filter(complete.cases(.))

dat_plt <- data.frame(pt$group, school_int) 
colnames(dat_plt) <- c("pt", "low", "up") 
dat_plt <- dat_plt %>% arrange(pt) 
dat_plt$index <- 1:nrow(dat_plt) 
dat_plt %>% ggplot(aes(x = index, y = pt)) + geom_errorbar(aes(ymin = low, ymax = up)) + geom_point(size = 4, shape = 18) + geom_point(size = 2.5, shape = 18, color = "white") + theme_bw()

```

## Using brms and diamondPlot

Set Rtools folder, if not in C:/Rtools/:
```{r}
# For some reason, having BINPREF in .Renviron doesn't work and I keep needing this:
Sys.setenv("BINPREF" = "C:/HYApp/Rtools3.4/mingw_$(WIN)/bin/")
```


```{r randeff-plot-brms-mvpa, fig.height = 4, fig.width = 12, eval = FALSE}

library(brms)

# Centre the variable:
df <- df %>% mutate(paAccelerometer_T1_centred = 
                      paAccelerometer_T1 - mean(paAccelerometer_T1, na.rm = TRUE))

m_1 <- brms::bf(paAccelerometer_T1_centred ~ (1 | group)) 
get_prior(m_1, data = df)

fit_1 <- brms::brm(m_1, df)

pt <- brms::ranef(fit_1, robust = TRUE) %>% 
  data.frame %>% 
  select(credintLow = group.2.5.ile.Intercept,
         intercept = group.Estimate.Intercept, 
         credintHigh = group.97.5.ile.Intercept) %>% 
  arrange(intercept)


plot1 <- userfriendlyscience::diamondPlot(pt, color = 'green', alpha=.3, yLabels = 1:58, fixedSize = 0.3, xlab = NULL) +
  coord_flip(expand = TRUE) +
  labs(x = "Deviance from average MVPA", y = "Group")


df %>% ggplot(aes(x = group, y = paAccelerometer_T1_centred)) +
  userfriendlyscience::diamondPlot(pt, color = 'green', alpha=.3, yLabels = 1:58, fixedSize = 0.3, xlab = NULL, returnLayerOnly = TRUE) +
  coord_flip(expand = TRUE) +
  labs(x = "Deviance from average MVPA", y = "Group")
   
forest(fit_1)
```

## Random effects in autonomous motivation

```{r randeff-plot-brms-autonomous, fig.height = 4, fig.width = 12}

# Centre the variable:
df <- df %>% mutate(PA_autonomous_T1_centred = PA_autonomous_T1 - mean(PA_autonomous_T1, na.rm = TRUE))

m_1 <- brms::bf(PA_autonomous_T1_centred ~ (1 | group)) 
get_prior(m_1, data = df)

fit_1 <- brms::brm(m_1, df)

pt <- brms::ranef(fit_1, robust = TRUE) %>% 
  data.frame %>% 
  select(credintLow = group.2.5.ile.Intercept,
         intercept = group.Estimate.Intercept, 
         credintHigh = group.97.5.ile.Intercept) %>% 
  arrange(intercept)


plot1 <- userfriendlyscience::diamondPlot(pt, color = 'blue', alpha=.3, yLabels = 1:59, fixedSize = 0.3, xlab = NULL) +
  coord_flip(expand = TRUE) +
  labs(x = "Deviance from average motivation", y = "Group")


df %>% ggplot(aes(x = group, y = PA_autonomous_T1_centred)) +
  userfriendlyscience::diamondPlot(pt, color = 'blue', alpha=.3, yLabels = 1:59, fixedSize = 0.3, xlab = NULL, returnLayerOnly = TRUE) +
  coord_flip(expand = TRUE) +
  labs(x = "Deviance from average motivation", y = "Group")
   

```


# Ridge plots

## PA motivation

```{r}

plot1 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'PA autonomous \nmotivation' = PA_autonomous_T1,
'PA controlled \nmotivation' = PA_controlled_T1,
'PA amotivation' = PA_amotivation_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, girl)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA amotivation 0", "PA amotivation 1"),
                      labels = c( 'PA amotivation 0' = "Boy", 'PA amotivation 1' = "Girl"),
                      values = c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

plot2 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'PA autonomous motivation' = PA_autonomous_T1,
'PA controlled motivation' = PA_controlled_T1,
'PA amotivation' = PA_amotivation_T1) %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, intervention)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA amotivation 1", "PA amotivation 0"),
                      labels = c('PA amotivation 1' = "Intervention", 'PA amotivation 0' = "Control"),
                      values = c("#ff0000", "#0000ff", "#ff8080", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

# grid.arrange(plot1, plot2, ncol = 2)

grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))
```

## Big 5 personality traits

```{r}

plot1 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Agreeableness' = b5agr_T1,
'Conscientiousness' = b5cons_T1,
'Extraversion' = b5ext_T1,
'Neuroticism' = b5neur_T1,
'Openness' = b5open_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, girl)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("Agreeableness 0", "Agreeableness 1"),
                      labels = c( 'Agreeableness 0' = "Boy", 'Agreeableness 1' = "Girl"),
                      values = c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

plot2 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Agreeableness' = b5agr_T1,
'Conscientiousness' = b5cons_T1,
'Extraversion' = b5ext_T1,
'Neuroticism' = b5neur_T1,
'Openness' = b5open_T1) %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, intervention)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("Agreeableness 1", "Agreeableness 0"),
                      labels = c('Agreeableness 1' = "Intervention", 'Agreeableness 0' = "Control"),
                      values = c("#ff0000", "#0000ff", "#ff8080", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

# grid.arrange(plot1, plot2, ncol = 2)

grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))
```

## BCT use

### Ridge plots for means

```{r}

plot1 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Frequency-\nrelated BCTs' = PA_frqbct_T1,
'Agreement-\nrelated BCTs' = PA_agrbct_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, girl)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("Agreement-\nrelated BCTs 0", "Agreement-\nrelated BCTs 1"),
                      labels = c( 'Agreement-\nrelated BCTs 0' = "Boy", 'Agreement-\nrelated BCTs 1' = "Girl"),
                      values = c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

plot2 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Frequency-\nrelated BCTs' = PA_frqbct_T1,
'Agreement-\nrelated BCTs' = PA_agrbct_T1) %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, intervention)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("Agreement-\nrelated BCTs 1", "Agreement-\nrelated BCTs 0"),
                      labels = c('Agreement-\nrelated BCTs 1' = "Intervention", 'Agreement-\nrelated BCTs 0' = "Control"),
                      values = c("#ff0000", "#0000ff", "#ff8080", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))



# grid.arrange(plot1, plot2, ncol = 2)

```



### sm kernel density plots for means

#### Frequency-measured BCTs

```{r}

colfill <- c(1,2,3,4,5)

# Create data frame
densplot <- df
levels(densplot$intervention) <- list("Intervention" = "1", "Control" = "0")
levels(densplot$girl) <- list("Girl" = "1", "Boy" = "0")

# This gives side-by-side plots
 layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights=c(2.5, 2))

## Intervention vs. control
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_frqbct_T1, intervention) %>% 
  na.omit(.)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_frqbct_T1_1 <- sm.density.compare2(as.numeric(dens$PA_frqbct_T1), as.factor(dens$intervention), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$intervention), fill=c(1, 2))

## Girls vs. boys
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_frqbct_T1, girl) %>% 
  na.omit(.)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_frqbct_T1_2 <- sm.density.compare2(as.numeric(dens$PA_frqbct_T1), as.factor(dens$girl), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$girl), fill=c(1, 2))

## Differences in schools
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_frqbct_T1, school) %>% 
  na.omit(.)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Intervention groups with solid thicker lines
linetypes <- c(1,2,2,1,2)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_frqbct_T1_3 <- sm::sm.density.compare(as.numeric(dens$PA_frqbct_T1), dens$school, xlab="", col=colfill, lty=linetypes, model="none")
legend("topright", c("Intervention school", "Control school"), col = c(4, 3), lty = c(1, 2), lwd = c(2, 2))

```

#### Agreement-measured BCTs

```{r}

colfill <- c(1,2,3,4,5)

# Create data frame
densplot <- df
levels(densplot$intervention) <- list("Intervention" = "1", "Control" = "0")
levels(densplot$girl) <- list("Girl" = "1", "Boy" = "0")

# This gives side-by-side plots
 layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights=c(2.5, 2))

## Intervention vs. control
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_agrbct_T1, intervention) %>% 
  na.omit(.)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_agrbct_T1_1 <- sm.density.compare2(as.numeric(dens$PA_agrbct_T1), as.factor(dens$intervention), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$intervention), fill=c(1, 2))

## Girls vs. boys
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_agrbct_T1, girl) %>% 
  na.omit(.)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_agrbct_T1_2 <- sm.density.compare2(as.numeric(dens$PA_agrbct_T1), as.factor(dens$girl), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$girl), fill=c(1, 2))

## Differences in schools
# Choose only the variables needed and drop NA
dens <- densplot %>% select(PA_agrbct_T1, school) %>% 
  na.omit(.)

# Intervention groups with solid thicker lines
linetypes <- c(1,2,2,1,2)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.PA_agrbct_T1_3 <- sm::sm.density.compare(as.numeric(dens$PA_agrbct_T1), dens$school, xlab="", col=colfill, lty=linetypes, model="none")
legend("topright", c("Intervention school", "Control school"), col = c(4, 3), lty = c(1, 2), lwd = c(2, 2))

```

### Histograms for individual items

#### Frequency-measured BCTs

These questions were asked with the lead "Have you done the following during the last three weeks?". 

The answer scale was as follows:

0 = not once
1 = once
2 = twice
3 = weekly
4 = about every second day
5 = daily

Items are as follows: 

1. I have reminded myself even in my spare time, what kind of positive consequences frequent PA would have in my life.
2. I have monitored my PA by marking the PA occasions on an exercise log on paper.
3. I have monitored my PA by using a smart phone, e.g. the Moves-app.
4. I use mnemonic cues with which I remember to implement my PA intention.
5. I have compared my actualized PA with the PA goal I have set.
6. I have thought about which reasons to do PA are important to me personally.
7. I have made changes in my home (e.g. my room or my computer), so that starting PA would be easier.
8. I have asked my friends or family for support to reach my PA goals.
9. If I haven't reached my PA goal, I have evaluated, what went wrong.

```{r}

bctGirls <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Reminded self of positive consequences' = PA_frqbct_01_T1,
'Has logged PA on paper' = PA_frqbct_02_T1,
'Has monitored PA on smartphone' = PA_frqbct_03_T1,
'Uses mnemonic cues' = PA_frqbct_04_T1,
'Has compared actual with goal' = PA_frqbct_05_T1,
'Has thought of relevance of PA' = PA_frqbct_06_T1,
'Has made changes at home' = PA_frqbct_07_T1,
'Has sought social support' = PA_frqbct_08_T1,
'Has evaluated why goal not reached' = PA_frqbct_09_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Girls") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctBoys <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Reminded self of positive consequences' = PA_frqbct_01_T1,
'Has logged PA on paper' = PA_frqbct_02_T1,
'Has monitored PA on smartphone' = PA_frqbct_03_T1,
'Uses mnemonic cues' = PA_frqbct_04_T1,
'Has compared actual with goal' = PA_frqbct_05_T1,
'Has thought of relevance of PA' = PA_frqbct_06_T1,
'Has made changes at home' = PA_frqbct_07_T1,
'Has sought social support' = PA_frqbct_08_T1,
'Has evaluated why goal not reached' = PA_frqbct_09_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Boys") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctInt <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Reminded self of positive consequences' = PA_frqbct_01_T1,
'Has logged PA on paper' = PA_frqbct_02_T1,
'Has monitored PA on smartphone' = PA_frqbct_03_T1,
'Uses mnemonic cues' = PA_frqbct_04_T1,
'Has compared actual with goal' = PA_frqbct_05_T1,
'Has thought of relevance of PA' = PA_frqbct_06_T1,
'Has made changes at home' = PA_frqbct_07_T1,
'Has sought social support' = PA_frqbct_08_T1,
'Has evaluated why goal not reached' = PA_frqbct_09_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "") +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Intervention") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctCont <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'Reminded self of positive consequences' = PA_frqbct_01_T1,
'Has logged PA on paper' = PA_frqbct_02_T1,
'Has monitored PA on smartphone' = PA_frqbct_03_T1,
'Uses mnemonic cues' = PA_frqbct_04_T1,
'Has compared actual with goal' = PA_frqbct_05_T1,
'Has thought of relevance of PA' = PA_frqbct_06_T1,
'Has made changes at home' = PA_frqbct_07_T1,
'Has sought social support' = PA_frqbct_08_T1,
'Has evaluated why goal not reached' = PA_frqbct_09_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Control") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

#grid.arrange(bctInt, bctGirls, bctCont, bctBoys, ncol = 2)

# ("Seldom or never", "About once a month", "About once a week", "Almost daily")

# This draws all histograms next to each other:
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(bctInt), ggplotGrob(bctCont), ggplotGrob(bctGirls), ggplotGrob(bctBoys), size = "last"))

# This draws 2 histograms per row:
# grid.newpage()
# grid.draw(rbind(cbind(ggplotGrob(bctInt), ggplotGrob(bctCont), size = "last"), cbind(ggplotGrob(bctGirls), ggplotGrob(bctBoys), size = "last")))

```


#### Agreement-measured BCTs

These questions were asked with the lead "Have you done the following during the last three weeks?". 

The answer scale was as follows:

0 = not at all true
1 ... 4 [unlabeled]
5 = completely true

Items are as follows: 

1. I have set PA goals for myself.
2. I have personally made a specific plan ("what, where, how") to implement my PA.
3. I have a PA plan, which has been made by someone else, e.g. my sports club (e.g. a workout schedule).
4. I have a way by which I remind myself of my PA plan, e.g. I write it down in the calendar.
5. I have cut larger PA goals to smaller subgoals.
6. I have tried out new ways for me to be physically active.
7. I have pondered, what kind of difficult situations or barriers prevent me from implementing my PA plan.
8. I have planned for ways to overcome barriers to doing PA.
9. I have thought about how PA fits my identity (self concept).
10. I have attempted to find ways to exercise so, that it won't obstruct but instead helps actualise my other life values.


```{r}

bctGirls <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'Has set goals' = PA_agrbct_01_T1,
  'Has made plan' = PA_agrbct_02_T1,
  'Plan made by other' = PA_agrbct_03_T1,
  'Has reminder of plan' = PA_agrbct_04_T1,
  'Has cut goals to subgoals' = PA_agrbct_05_T1,
  'Has tried new PA options' = PA_agrbct_06_T1,
  'Has thought of barriers' = PA_agrbct_07_T1,
  'Has planned for barriers' = PA_agrbct_08_T1,
  'Has thought of PA identity' = PA_agrbct_09_T1,
  'Has fitted PA to life values' = PA_agrbct_10_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Girls") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctBoys <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'Has set goals' = PA_agrbct_01_T1,
  'Has made plan' = PA_agrbct_02_T1,
  'Plan made by other' = PA_agrbct_03_T1,
  'Has reminder of plan' = PA_agrbct_04_T1,
  'Has cut goals to subgoals' = PA_agrbct_05_T1,
  'Has tried new PA options' = PA_agrbct_06_T1,
  'Has thought of barriers' = PA_agrbct_07_T1,
  'Has planned for barriers' = PA_agrbct_08_T1,
  'Has thought of PA identity' = PA_agrbct_09_T1,
  'Has fitted PA to life values' = PA_agrbct_10_T1) %>%
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Boys") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctInt <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'Has set goals' = PA_agrbct_01_T1,
  'Has made plan' = PA_agrbct_02_T1,
  'Plan made by other' = PA_agrbct_03_T1,
  'Has reminder of plan' = PA_agrbct_04_T1,
  'Has cut goals to subgoals' = PA_agrbct_05_T1,
  'Has tried new PA options' = PA_agrbct_06_T1,
  'Has thought of barriers' = PA_agrbct_07_T1,
  'Has planned for barriers' = PA_agrbct_08_T1,
  'Has thought of PA identity' = PA_agrbct_09_T1,
  'Has fitted PA to life values' = PA_agrbct_10_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "") +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Intervention") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

bctCont <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  'Has set goals' = PA_agrbct_01_T1,
  'Has made plan' = PA_agrbct_02_T1,
  'Plan made by other' = PA_agrbct_03_T1,
  'Has reminder of plan' = PA_agrbct_04_T1,
  'Has cut goals to subgoals' = PA_agrbct_05_T1,
  'Has tried new PA options' = PA_agrbct_06_T1,
  'Has thought of barriers' = PA_agrbct_07_T1,
  'Has planned for barriers' = PA_agrbct_08_T1,
  'Has thought of PA identity' = PA_agrbct_09_T1,
  'Has fitted PA to life values' = PA_agrbct_10_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:6), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Control") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 6.5))

#grid.arrange(bctInt, bctGirls, bctCont, bctBoys, ncol = 2)

# ("Seldom or never", "About once a month", "About once a week", "Almost daily")

# This draws all histograms next to each other:
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(bctInt), ggplotGrob(bctCont), ggplotGrob(bctGirls), ggplotGrob(bctBoys), size = "last"))

# This draws 2 histograms per row:
# grid.newpage()
# grid.draw(rbind(cbind(ggplotGrob(bctInt), ggplotGrob(bctCont), size = "last"), cbind(ggplotGrob(bctGirls), ggplotGrob(bctBoys), size = "last")))

# bctBoys <- df %>% dplyr::select(id,
#   intervention,
#   group,
#   school,
#   girl,
#   'Has set goals' = PA_agrbct_01_T1,
#   'Has made plan' = PA_agrbct_02_T1,
#   'Plan made by other' = PA_agrbct_03_T1,
#   'Has reminder of plan' = PA_agrbct_04_T1,
#   'Has cut goals to subgoals' = PA_agrbct_05_T1,
#   'Has tried new PA options' = PA_agrbct_06_T1,
#   'Has thought of barriers' = PA_agrbct_07_T1,
#   'Has planned for barriers' = PA_agrbct_08_T1,
#   'Has thought of PA identity' = PA_agrbct_09_T1,
#   'Has fitted PA to life values' = PA_agrbct_10_T1)
# 
# mean(bctBoys$`Has set goals`, na.rm = T)
# mean(bctBoys$`Has made plan`, na.rm = T)
# mean(bctBoys$`Plan made by other`, na.rm = T)
# mean(bctBoys$`Has reminder of plan`, na.rm = T)
# mean(bctBoys$`Has cut goals to subgoals`, na.rm = T)
# mean(bctBoys$`Has tried new PA options`, na.rm = T)
# mean(bctBoys$`Has thought of barriers`, na.rm = T)
# mean(bctBoys$`Has planned for barriers`, na.rm = T)
# mean(bctBoys$`Has thought of PA identity`, na.rm = T)
# mean(bctBoys$`Has fitted PA to life values`, na.rm = T)
```



## PA determinants


### Plot without fill

```{r}
plot1 <- df %>% dplyr::select(id,
                              intervention,
                              group,
                              school,
                              girl,
                              'PA intention' = PA_intention_T1,
                              'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
                              'PA perceived\nbehavioural control' = PA_pbc_T1,
                              'PA self efficacy' = PA_selfefficacy_T1,
                              'PA perceived\nopportunities' = PA_opportunities_T1,
                              'PA descriptive\nnorm' = PA_dnorm_T1,
                              'PA injunctive\nnorm' = PA_inorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>%
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, colour = paste(Variable, girl), 
                                    fill = paste(Variable, girl)), 
                                    alpha = 0, size = 0.75, from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA injunctive\nnorm 0", "PA injunctive\nnorm 1"),
                                labels = c( 'PA injunctive\nnorm 0' = "Boy", 'PA injunctive\nnorm 1' = "Girl"),
                                values = viridis::viridis(4, end = 0.8)[c(1, 3)], #c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                                name = "", guide = guide_legend(override.aes = list(alpha = 1))) +
  ggridges::scale_colour_cyclical(values = viridis::viridis(4, end = 0.8, alpha = 0.9)[c(1, 3)]) +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10)) +
  geom_hline(yintercept = 1:7)

target = c(
"PA_intention_T1",
"PA_outcomeExpectations_T1",
"PA_pbc_T1",
"PA_selfefficacy_T1",
"PA_opportunities_T1",
"PA_dnorm_T1",
"PA_inorm_T1")

PA_ci_girls <- ci_girls %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_girls <- PA_ci_girls[match(target, PA_ci_girls$diamondlabels), ]

PA_ci_boys <- ci_boys %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_boys <- PA_ci_boys[match(target, PA_ci_boys$diamondlabels), ]

plot1 <- plot1 + userfriendlyscience::diamondPlot(PA_ci_girls, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[c(3)], 
                alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_boys, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[c(1)],  
                alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

plot2 <- df %>% dplyr::select(id,
                              intervention,
                              group,
                              school,
                              girl,
                              'PA intention' = PA_intention_T1,
                              'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
                              'PA perceived\nbehavioural control' = PA_pbc_T1,
                              'PA self efficacy' = PA_selfefficacy_T1,
                              'PA perceived\nopportunities' = PA_opportunities_T1,
                              'PA descriptive\nnorm' = PA_dnorm_T1,
                              'PA injunctive\nnorm' = PA_inorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>%
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, colour = paste(Variable, intervention), 
                                    fill = paste(Variable, intervention)), 
                                    alpha = 0, size = 0.75, from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA injunctive\nnorm 0", "PA injunctive\nnorm 1"),
                                labels = c( 'PA injunctive\nnorm 0' = "Control", 'PA injunctive\nnorm 1' = "Intervention"),
                                values = c(viridis::viridis(4, end = 0.8)[c(2, 4)], viridis::viridis(8, end = 0.8)[c(4, 8)]), # get 2 x 2 colors, close to each other MUUTTAAKO MITN?
                                name = "", guide = guide_legend(override.aes = list(alpha = 1))) +
  ggridges::scale_colour_cyclical(values = viridis::viridis(4, end = 0.8, alpha = 0.9)[c(2, 4)]) +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10)) +
  geom_hline(yintercept = 1:7)

PA_ci_intervention <- ci_intervention %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_intervention <- PA_ci_intervention[match(target, PA_ci_intervention$diamondlabels), ]

PA_ci_control <- ci_control %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_control <- PA_ci_control[match(target, PA_ci_control$diamondlabels), ]

plot2 <- plot2 + 
  userfriendlyscience::diamondPlot(PA_ci_intervention, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[c(4)],
              alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_control, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[c(2)], 
              alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

# grid.arrange(plot1, plot2, ncol = 2)
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))
```

### Pretty plot with fill

```{r}

plot1 <- df %>% dplyr::select(id,
                              intervention,
                              group,
                              school,
                              girl,
                              'PA intention' = PA_intention_T1,
                              'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
                              'PA perceived\nbehavioural control' = PA_pbc_T1,
                              'PA self efficacy' = PA_selfefficacy_T1,
                              'PA perceived\nopportunities' = PA_opportunities_T1,
                              'PA descriptive\nnorm' = PA_dnorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>%
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, colour = "black", 
                                    fill = paste(Variable, girl)), 
                                    alpha = 0.6, size = 0.25, from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA descriptive\nnorm 0", "PA descriptive\nnorm 1"),
                                labels = c( 'PA descriptive\nnorm 0' = "Boy", 'PA descriptive\nnorm 1' = "Girl"),
                                values = viridis::viridis(4, end = 0.8)[c(1, 3)],
                                name = "", guide = guide_legend(override.aes = list(alpha = 1))) +
  ggridges::scale_colour_cyclical(values = "black") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10))

target = c(
"PA_intention_T1",
"PA_outcomeExpectations_T1",
"PA_pbc_T1",
"PA_selfefficacy_T1",
"PA_opportunities_T1",
"PA_dnorm_T1")

PA_ci_girls <- ci_girls %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels))

PA_ci_girls <- PA_ci_girls[match(target, PA_ci_girls$diamondlabels), ]

PA_ci_boys <- ci_boys %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels))

PA_ci_boys <- PA_ci_boys[match(target, PA_ci_boys$diamondlabels), ]

plot1 <- plot1 + userfriendlyscience::diamondPlot(PA_ci_girls, returnLayerOnly = TRUE, lineColor = "black", color=viridis::viridis(4, end = 0.8)[3], 
                alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_boys, returnLayerOnly = TRUE, lineColor = "black", linetype = "solid", color=viridis::viridis(4, end = 0.8)[1],  
                alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

plot2 <- df %>% dplyr::select(id,
                              intervention,
                              group,
                              school,
                              girl,
                              'PA intention' = PA_intention_T1,
                              'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
                              'PA perceived\nbehavioural control' = PA_pbc_T1,
                              'PA self efficacy' = PA_selfefficacy_T1,
                              'PA perceived\nopportunities' = PA_opportunities_T1,
                              'PA descriptive\nnorm' = PA_dnorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>%
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, colour = "black", 
                                    fill = paste(Variable, intervention)), 
                                    alpha = 0.75, size = 0.25, from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA descriptive\nnorm 0", "PA descriptive\nnorm 1"),
                                labels = c( 'PA descriptive\nnorm 0' = "Control", 'PA descriptive\nnorm 1' = "Intervention"),
                                values = viridis::viridis(4, end = 0.8)[c(2, 4)],
                                name = "", guide = guide_legend(override.aes = list(alpha = 1))) +
  ggridges::scale_colour_cyclical(values = "black") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10))

PA_ci_intervention <- ci_intervention %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels))

PA_ci_intervention <- PA_ci_intervention[match(target, PA_ci_intervention$diamondlabels), ]

PA_ci_control <- ci_control %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels))

PA_ci_control <- PA_ci_control[match(target, PA_ci_control$diamondlabels), ]

plot2 <- plot2 + 
  userfriendlyscience::diamondPlot(PA_ci_intervention, returnLayerOnly = TRUE, lineColor = "black", color=viridis::viridis(4, end = 0.8)[4],
              alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_control, returnLayerOnly = TRUE, lineColor = "black", color=viridis::viridis(4, end = 0.8)[2], 
              alpha=.6, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

# grid.arrange(plot1, plot2, ncol = 2)
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))

# Test that the legend is right; descriptive norms are smaller for girls
df %>% group_by(girl) %>% summarise(mean = mean(PA_dnorm_T1, na.rm = T)) %>% filter(girl == "1") %>% select(mean) < df %>% group_by(girl) %>% summarise(mean = mean(PA_dnorm_T1, na.rm = T)) %>% filter(girl == "0") %>% select(mean)

# KESKEN: iv/ctrl-legend
df %>% group_by(intervention) %>% summarise(mean = mean(PA_dnorm_T1, na.rm = TRUE)) %>% filter(intervention == "1") %>% select(mean) < df %>% group_by(intervention) %>% summarise(mean = mean(PA_dnorm_T1, na.rm = T)) %>% filter(intervention == "0") %>% select(mean)
```

```{r}
library(viridis::viridis)
plot1 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'PA action and\ncoping planning' = PA_actCop_T1,
'PA intention' = PA_intention_T1,
'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
'PA perceived\nbehavioural control' = PA_pbc_T1,
'PA self efficacy' = PA_selfefficacy_T1,
'PA perceived\nopportunities' = PA_opportunities_T1,
'PA descriptive\nnorm' = PA_dnorm_T1,
'PA injunctive\nnorm' = PA_inorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, girl)), 
           alpha = .1, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA injunctive\nnorm 0", "PA injunctive\nnorm 1"),
                      labels = c( 'PA injunctive\nnorm 0' = "Boy", 'PA injunctive\nnorm 1' = "Girl"),
                      values = viridis::viridis(4, end = 0.8)[1:2], #c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10))

plot2 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'PA action and\ncoping planning' = PA_actCop_T1,
'PA intention' = PA_intention_T1,
'PA outcome\nexpectations' = PA_outcomeExpectations_T1,
'PA perceived\nbehavioural control' = PA_pbc_T1,
'PA self efficacy' = PA_selfefficacy_T1,
'PA perceived\nopportunities' = PA_opportunities_T1,
'PA descriptive\nnorm' = PA_dnorm_T1,
'PA injunctive\nnorm' = PA_inorm_T1) %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.), factor_key = TRUE) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, intervention)), 
           alpha = .9, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("PA injunctive\nnorm 1", "PA injunctive\nnorm 0"),
                      labels = c('PA injunctive\nnorm 1' = "Intervention", 'PA injunctive\nnorm 0' = "Control"),
                      values = viridis::viridis(4, end = 0.8)[3:4], #c("#ff0000", "#0000ff", "#ff8080", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom", axis.text=element_text(size=10))

target = c("PA_actCop_T1",
"PA_intention_T1",
"PA_outcomeExpectations_T1",
"PA_pbc_T1",
"PA_selfefficacy_T1",
"PA_opportunities_T1",
"PA_dnorm_T1",
"PA_inorm_T1")

PA_ci_girls <- ci_girls %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_actCop_T1", diamondlabels) | 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_girls <- PA_ci_girls[match(target, PA_ci_girls$diamondlabels), ]

PA_ci_boys <- ci_boys %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_actCop_T1", diamondlabels) | 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_boys <- PA_ci_boys[match(target, PA_ci_boys$diamondlabels), ]

plot1 <- plot1 + 
  userfriendlyscience::diamondPlot(PA_ci_girls, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[1],# 'blue', 
                alpha=.95, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_boys, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[2], #'green', 
                alpha=.95, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

PA_ci_intervention <- ci_intervention %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_actCop_T1", diamondlabels) | 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_intervention <- PA_ci_intervention[match(target, PA_ci_intervention$diamondlabels), ]

PA_ci_control <- ci_control %>% filter(diamondlabels %in% names(scales_T1) & 
                                     grepl("PA_actCop_T1", diamondlabels) | 
                                     grepl("PA_intention_T1", diamondlabels) | 
                                     grepl("PA_outcomeExpectations_T1", diamondlabels) | 
                                     grepl("PA_pbc_T1", diamondlabels) | 
                                     grepl("PA_selfefficacy_T1", diamondlabels) | 
                                     grepl("PA_opportunities_T1", diamondlabels) | 
                                     grepl("PA_dnorm_T1", diamondlabels) | 
                                     grepl("PA_inorm_T1", diamondlabels))

PA_ci_control <- PA_ci_control[match(target, PA_ci_control$diamondlabels), ]

plot2 <- plot2 + 
  userfriendlyscience::diamondPlot(PA_ci_intervention, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[4],# 'blue',
              alpha=.95, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2)) +
  userfriendlyscience::diamondPlot(PA_ci_control, returnLayerOnly = TRUE, color=viridis::viridis(4, end = 0.8)[3], #'red', 
              alpha=.95, fixedSize = 0.15, otherAxisCol = (1:length(target) + .2))

# grid.arrange(plot1, plot2, ncol = 2)
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(plot1), ggplotGrob(plot2), size = "first"))
```

```{r}
library(visreg)
library(broom)

m_pbcgirl <- lme4::lmer(PA_pbc_T1 ~ girl + (1 | school), data = df)
summary(m_pbcgirl)

visreg::visreg(m_pbcgirl, "school", type = "contrast")

visreg(m_pbcgirl, "girl", by="school", re.form=~(1|school))

glance(m_pbcgirl)
```

## SB determinants

```{r}

plot1 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'SB intention' = SB_intention_T1,
'SB outcome\nexpectations' = SB_outcomeExpectations_T1,
'SB self-efficacy\nand perceived\nbehavioural control' = SB_sePbc_T1,
'SB descriptive\nnorm' = SB_dnorm_T1,
'SB injunctive\nnorm' = SB_inorm_T1)  %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, girl)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("SB injunctive\nnorm 0", "SB injunctive\nnorm 1"),
                      labels = c( 'SB injunctive\nnorm 0' = "Boy", 'SB injunctive\nnorm 1' = "Girl"),
                      values = c("#3bc600", "#0000ff", "#9cc68b", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

plot2 <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
'SB intention' = SB_intention_T1,
'SB outcome\nexpectations' = SB_outcomeExpectations_T1,
'SB self-efficacy\nand perceived\nbehavioural control' = SB_sePbc_T1,
'SB descriptive\nnorm' = SB_dnorm_T1,
'SB injunctive\nnorm' = SB_inorm_T1) %>%
  # select(noquote(order(colnames(.)))) %>% # Orders columns alphabetically
  tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>% 
  ggplot(aes(y = Variable)) +
  ggridges::geom_density_ridges(aes(x = Value, fill = paste(Variable, intervention)), 
           alpha = .6, color = "black", from = 1, to = 7) +
  labs(x = "",
       y = "") +
  scale_y_discrete(expand = c(0.01, 0), labels = NULL) +
  scale_x_continuous(expand = c(0.01, 0)) +
  ggridges::scale_fill_cyclical(breaks = c("SB injunctive\nnorm 1", "SB injunctive\nnorm 0"),
                      labels = c('SB injunctive\nnorm 1' = "Intervention", 'SB injunctive\nnorm 0' = "Control"),
                      values = c("#ff0000", "#0000ff", "#ff8080", "#8080ff"),
                      name = "", guide = "legend") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(legend.position="bottom")

gridExtra::grid.arrange(plot1, plot2, ncol = 2)
```

# CIBER (not included for now)

```{r, eval = FALSE}
#p_install("userfriendlyscience")

# cat(names(df), sep = "\",\n\"")

# Make variables numeric, and d as data frame
d_num <- df %>% mutate_all(as.numeric) 
d_num <- as.data.frame(d_num)

userfriendlyscience::CIBER(data = d_num,
      determinants = c(
        "actCop_T1",
        "agrbct_T1",
        "amotivation_T1",
        "autonomous_T1",
        "b5agr_T1.1",
        "b5cons_T1.1",
        "b5ext_T1.1",
        "b5neur_T1.1",
        "b5open_T1.1",
        "controlled_T1",
        "dnorm_T1",
        "frqbct_T1",
        "goal_T1",
        "inorm_T1",
        "intention_T1",
        "outcomeExpectations_T1",
        "opportunities_T1",
        "pbc_T1",
        "selfefficacy_T1"),
      targets = c("paT1", "fatpct_T1"),
      conf.level = list(means = 0.9999,
                        associations = 0.99)
      )

userfriendlyscience::CIBER(data = d_num,
      determinants = c(
        "actCop_T1",
        "agrbct_T1",
        "frqbct_T1",
        "amotivation_T1",
        "autonomous_T1",
        "controlled_T1",
        "dnorm_T1",
        "intention_T1",
        "outcomeExpectations_T1",
        "opportunities_T1",
        "sePbc_T1"),
      targets = c("paT1", "fatpct_T1"),
      conf.level = list(means = 0.9999,
                        associations = 0.99)
      )

# to create variable list for CIBER:
# cat(names(d), sep = "\",\n\"")

userfriendlyscience::CIBER(data = d_num,
  determinants = c(
  "agrbct_01_T1",
  "agrbct_02_T1",
  "agrbct_03_T1",
  "agrbct_04_T1",
  "agrbct_05_T1",
  "agrbct_06_T1",
  "agrbct_07_T1",
  "agrbct_08_T1",
  "agrbct_09_T1",
  "agrbct_10_T1",
  "frqbct_01_T1",
  "frqbct_02_T1",
  "frqbct_03_T1",
  "frqbct_04_T1",
  "frqbct_05_T1",
  "frqbct_06_T1",
  "frqbct_07_T1",
  "frqbct_08_T1",
  "frqbct_09_T1"),
   targets = c("MVPA", "SB"),
  leftAnchors = rep("", 19),
  rightAnchors = rep("", 19))

userfriendlyscience::CIBER(data = d_num,
  determinants = c(
  "autonomous_01_T1",
  "autonomous_02_T1",
  "autonomous_03_T1",
  "autonomous_04_T1",
  "autonomous_05_T1",
  "autonomous_06_T1",
  "autonomous_07_T1",
  "autonomous_08_T1",
  "autonomous_09_T1"),
   targets = c("MVPA", "SB"),
  leftAnchors = rep("", 9),
  rightAnchors = rep("", 9))

userfriendlyscience::CIBER(data = d_num,
  determinants = c(
  "intention_01_T1",
  "intention_02_T1",
  "selfefficacy_01_T1",
  "selfefficacy_02_T1",
  "pbc_01_T1",
  "pbc_02_T1",
  "pbc_03_T1",
  "norm_01_T1",
  "norm_02_T1",
  "outcomeExpectations_01_T1",
  "outcomeExpectations_02_T1",
  "outcomeExpectations_03_T1",
  "outcomeExpectations_04_T1",
  "outcomeExpectations_05_T1",
  "outcomeExpectations_06_T1",
  "outcomeExpectations_07_T1",
  "outcomeExpectations_08_T1",
  "outcomeExpectations_09_T1",
  "outcomeExpectations_10_T1",
  "outcomeExpectations_11_T1",
  "outcomeExpectations_12_T1"),
   targets = c("MVPA", "SB"),
  leftAnchors = rep("", 21),
  rightAnchors = rep("", 21))
```

# Density plots

## Accelerometer-measured PA

Contrary to some other findings, in our sample girls were more active than boys. 

```{r}

MVPAgirl_df <- df %>% group_by(girl) %>% select(girl, paAccelerometer_T1) %>% summarise(mean = mean(paAccelerometer_T1, na.rm = TRUE), median = median(paAccelerometer_T1, na.rm = TRUE))
MVPAgirl_df[1, 2] - MVPAgirl_df[2, 2]
MVPAgirl_df[1, 3] - MVPAgirl_df[2, 3]

userfriendlyscience::meanDiff(df$girl, df$paAccelerometer_T1)

```

```{r}

colfill <- c(1,2,3,4,5)

# Create data frame
densplot <- d
levels(densplot$intervention) <- list("Intervention" = "1", "Control" = "0")
levels(densplot$girl) <- list("Girl" = "1", "Boy" = "0")

# This gives side-by-side plots
 layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights=c(2.5, 2))

## Intervention vs. control
# Choose only the variables needed and drop NA
dens <- densplot %>% select(paAccelerometer_T1, intervention) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.paAccelerometer_T1_1 <- sm.density.compare2(as.numeric(dens$paAccelerometer_T1), as.factor(dens$intervention), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$intervention), fill=c(1, 2))

## Girls vs. boys
# Choose only the variables needed and drop NA
dens <- densplot %>% select(paAccelerometer_T1, girl) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)
# Make plot
sm.paAccelerometer_T1_2 <- sm.density.compare2(as.numeric(dens$paAccelerometer_T1), as.factor(dens$girl), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$girl), fill=c(1, 2))

## Differences in schools
# Choose only the variables needed and drop NA
dens <- densplot %>% select(paAccelerometer_T1, school) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Intervention groups with solid thicker lines
linetypes <- c(1,2,2,1,2)

# Make plot
sm.paAccelerometer_T1_3 <- sm::sm.density.compare(as.numeric(dens$paAccelerometer_T1), dens$school, xlab="", col=colfill, lty=linetypes, model="none")
legend("topright", c("Intervention school", "Control school"), col = c(4, 3), lty = c(1, 2), lwd = c(2, 2))

```

## Time spent sitting and lying down

```{r}

colfill <- c(1,2,3,4,5)

# Create data frame
densplot <- d
levels(densplot$intervention) <- list("Intervention" = "1", "Control" = "0")
levels(densplot$girl) <- list("Girl" = "1", "Boy" = "0")

# This gives side-by-side plots
 layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights=c(2.5, 2))

## Intervention vs. control
# Choose only the variables needed and drop NA
dens <- densplot %>% select(sitLieAccelerometer_T1, intervention) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Make plot
sm.sitLieAccelerometer_T1_1 <- sm.density.compare2(as.numeric(dens$sitLieAccelerometer_T1), as.factor(dens$intervention), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$intervention), fill=c(1, 2))

## Girls vs. boys
# Choose only the variables needed and drop NA
dens <- densplot %>% select(sitLieAccelerometer_T1, girl) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Make plot
sm.sitLieAccelerometer_T1_2 <- sm.density.compare2(as.numeric(dens$sitLieAccelerometer_T1), as.factor(dens$girl), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$girl), fill=c(1, 2))

## Differences in schools
# Choose only the variables needed and drop NA
dens <- densplot %>% select(sitLieAccelerometer_T1, school) %>% 
  filter(complete.cases(.))

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Intervention groups with solid thicker lines
linetypes <- c(1,2,2,1,2)

# Make plot
sm.sitLieAccelerometer_T1_3 <- sm::sm.density.compare(as.numeric(dens$sitLieAccelerometer_T1), dens$school, xlab="", col=colfill, lty=linetypes, model="none")
legend("topright", c("Intervention school", "Control school"), col = c(4, 3), lty = c(1, 2), lwd = c(2, 2))

```

# Symptoms

```{r}

colfill <- c(1,2,3,4,5)

# Create data frame
densplot <- df
levels(densplot$intervention) <- list("Intervention" = "1", "Control" = "0")
levels(densplot$girl) <- list("Girl" = "1", "Boy" = "0")

# This gives side-by-side plots
 layout(matrix(c(1,2,3,3), nrow = 2, ncol = 2, byrow = TRUE), heights=c(2.5, 2))

## Intervention vs. control
# Choose only the variables needed and drop NA
dens <- densplot %>% select(symptom_T1, intervention) %>% na.omit(densplot)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Make plot
sm.symptom_T1_1 <- sm.density.compare2(as.numeric(dens$symptom_T1), as.factor(dens$intervention), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$intervention), fill=c(1, 2))

## Girls vs. boys
# Choose only the variables needed and drop NA
dens <- densplot %>% select(symptom_T1, girl)  %>% na.omit(densplot)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Make plot
sm.symptom_T1_2 <- sm.density.compare2(as.numeric(dens$symptom_T1), as.factor(dens$girl), xlab="", col=colfill, lty=c(1,2), bandcol='LightGray', model="equal", lwd=(c(2,2)))
legend("topright", levels(dens$girl), fill=c(1, 2))

## Differences in schools
# Choose only the variables needed and drop NA
dens <- densplot %>% select("Symptom sum score" = symptom_T1, school) %>% na.omit(densplot)

# Set random number generator for reproducibility of bootstrap test of equal densities
set.seed(10)

# Intervention groups with solid thicker lines
linetypes <- c(1,2,2,1,2)
linewidths <- c(2,1,1,2,1)

# Make plot
sm.symptom_T1_3 <- sm::sm.density.compare(dens$`Symptom sum score`, dens$school, xlab="", col=colfill, lty=linetypes, model="equal", lwd=linewidths)
xlab = ""


```

## Symptom histograms

### intervention / gender

```{r}

sympGirls <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Girls") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

sympBoys <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(girl == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Boys") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

sympInt <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "1") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "") +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Intervention") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10)) +
coord_cartesian(xlim = c(0.5, 4.5))

sympCont <- df %>% dplyr::select(id,
  intervention,
  group,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(intervention == "0") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Control") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

#grid.arrange(sympInt, sympGirls, sympCont, sympBoys, ncol = 2)

# ("Seldom or never", "About once a month", "About once a week", "Almost daily")

# This draws all histograms next to each other:
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(sympInt), ggplotGrob(sympCont), ggplotGrob(sympGirls), ggplotGrob(sympBoys), size = "last"))

# This draws 2 histograms per row:
#grid.newpage()
#grid.draw(rbind(cbind(ggplotGrob(sympInt), ggplotGrob(sympCont), size = "last"), cbind(ggplotGrob(sympGirls), ggplotGrob(sympBoys), size = "last")))


```

### educational track

```{r}

sympHRC <- df %>% dplyr::select(id,
  intervention,
  track,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(track == "HRC") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "HRC") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

sympNursing <- df %>% dplyr::select(id,
  intervention,
  track,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(track == "Nursing") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("darkolivegreen2", "darkolivegreen4")) +
  labs(title = "Nursing") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

sympIT <- df %>% dplyr::select(id,
  intervention,
  track,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(track == "Business IT") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "") +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Business IT") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10)) +
coord_cartesian(xlim = c(0.5, 4.5))

sympBA <- df %>% dplyr::select(id,
  intervention,
  track,
  school,
  girl,
  "Neck and shoulder pain" = symptom_neckShoulderPain_T1,
  "Lower back pain" = symptom_lowerBackPain_T1,
  "Stomach ache" = symptom_stomachAche_T1,
  "Tension or nervousness" = symptom_tensionNervousness_T1,
  "Irritability or anger bursts" = symptom_irritabilityAngerbursts_T1,
  "Difficulty with sleep" = symptom_sleepDifficulty_T1,
  "Headache" = symptom_headAche_T1,
  "Tiredness or faintness" = symptom_tirednessFaintness_T1) %>%
 tidyr::gather(key = Variable, value = Value, 6:ncol(.)) %>%
  filter(track == "Business Admin") %>% 
 ggplot(aes(x = Value, y = Variable, group = Variable)) +
  ggridges::geom_density_ridges2(aes(fill = Variable), stat = "binline", binwidth = 1, scale = 0.95) +
  scale_x_continuous(breaks = c(1:4), expand = c(0, 0),
                     name = "") +
  scale_y_discrete(expand = c(0.01, 0), name = "", labels = NULL) +
  ggridges::scale_fill_cyclical(values = c("deepskyblue", "deepskyblue4")) +
  labs(title = "Business Admin") +
  guides(y = "none") +
  ggridges::theme_ridges(grid = FALSE) +
  theme(axis.title.x = element_text(hjust = 0.5),
        axis.title.y = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.text=element_text(size=10, face="bold")) +
coord_cartesian(xlim = c(0.5, 4.5))

#grid.arrange(sympIT, sympHRC, sympBA, sympNursing, ncol = 2)

# ("Seldom or never", "About once a month", "About once a week", "Almost daily")

# This draws all histograms next to each other:
grid::grid.newpage()
grid::grid.draw(cbind(ggplotGrob(sympIT), ggplotGrob(sympBA), ggplotGrob(sympHRC), ggplotGrob(sympNursing), size = "last"))

# This draws 2 histograms per row:
#grid.newpage()
#grid.draw(rbind(cbind(ggplotGrob(sympIT), ggplotGrob(sympBA), size = "last"), cbind(ggplotGrob(sympHRC), ggplotGrob(sympNursing), size = "last")))


```

